---
layout: post
title: C# Async
description: Asynchronous programming in C#
published: true
---


## CancellationToken

```C#
using System;
using System.Threading;
using System.Threading.Tasks;

class Program
{
    static async Task Main()
    {
        using var cts = new CancellationTokenSource(); // Create a token source
        CancellationToken token = cts.Token;

        Task task = DoWorkAsync(token);

        // Listen for user input in a separate task
        _ = Task.Run(() =>
        {
            while (true)
            {
                if (Console.KeyAvailable)
                {
                    var key = Console.ReadKey(true).Key;
                    Console.WriteLine($"Key pressed: {key}");
                    if (key == ConsoleKey.B)
                    {
                        cts.Cancel();
                        break;
                    }
                }
            }
        });

        try
        {
            await task;
        }
        catch (OperationCanceledException)
        {
            Console.WriteLine("Task was canceled.");
        }
    }

    static async Task DoWorkAsync(CancellationToken token)
    {
        while (true)
        {
            token.ThrowIfCancellationRequested(); // Check for cancellation
            Console.WriteLine($"Working... Local time: {DateTime.Now:yyyy-MM-dd HH:mm:ss.fff}");
            await Task.Delay(1000);
        }
    }
}

```